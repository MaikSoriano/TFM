# Abre una muestra y reemplaza los eval('funcion ejemplo()') por: funcion ejemplo() 
import sys

if len(sys.argv) < 2:
	print "Usage: python repasarEval.py <fichero>"
	exit(0)
else:
	print "Input File: "+sys.argv[1]

#Abrimos la muestra
inFile = open(sys.argv[1], 'r')
#Abrimos el fichero destino

aux = sys.argv[1].split(".js")
nameOutFile = aux[0]+"-sinEval.js"
print "Output File: "+nameOutFile
outFile = open(nameOutFile, 'w')
evalCount = 0
print ""
print ""
print "###########################################"
print "####### Replacing eval('') Started #######"
print "###########################################"
print ""
print ""
for line in inFile:
	#comprobamos los eval
	position = line.find("eval('")
	if position == -1:
		position = line.find('eval("')
	#Si la linea no contiene eval se pinta como esta
	if position == -1:
		outFile.write(line)
	#Si contiene eval se analiza la linea
	else:
		print line
		position = position + 6 #Position +6 characters of "eval('"
		content = ""
		bracketsNum = 1
		lineToParse = line[position:]
		evalCount += 1

		for character in lineToParse:
			#buscamos el string pasado como parametro a eval
			if character == "(":
				bracketsNum += 1
			elif character == ")":
				bracketsNum -= 1
			
			if bracketsNum == 0:
				break

			content += character

		content = content[:len(content)-1] #quitamos la ultima comilla de eval

		content = content.replace("'+","")
		content = content.replace("+'","")
		content = content.replace('"+',"")
		content = content.replace('+"',"")

		outFile.write(content)
		print "vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv"
		print(content)
		print "######################################################################################"
		print ""

inFile.close()
outFile.close()
print ""
print ""
print "###########################################"
print "number of eval replaced: "+str(evalCount)
print "####### Replacing eval('') Finished #######"
